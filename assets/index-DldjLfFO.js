(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))d(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&d(f)}).observe(document,{childList:!0,subtree:!0});function o(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function d(r){if(r.ep)return;r.ep=!0;const l=o(r);fetch(r.href,l)}})();class C{constructor({id:t,title:o,description:d="",priority:r="low",projectId:l,completed:f=!1}){this.id=t??crypto.randomUUID(),this.title=o,this.description=d,this.priority=r,this.projectId=l,this.completed=f}markComplete(){this.completed=!0}restore(){this.completed=!1}toPlainObject(){return{...this}}}let i=[];const c={add(e){const t=new C(e);return i.push(t),t},edit(e,t){const o=this.getById(e);return o?(Object.assign(o,t),!0):!1},remove(e){const t=i.findIndex(o=>o.id===e);return t===-1?!1:(i.splice(t,1),!0)},removeByProject(e){i=i.filter(t=>t.projectId!==e)},markComplete(e){const t=this.getById(e);return t?(t.markComplete(),!0):!1},restore(e){const t=this.getById(e);return t?(t.restore(),!0):!1},moveToProject(e,t){const o=this.getById(e);return o?(o.projectId=t,!0):!1},clearCompleted(){i=i.filter(e=>!e.completed)},getById(e){return i.find(t=>t.id===e)},getByProject(e){return i.filter(t=>t.projectId===e&&!t.completed)},getCompleted(){return i.filter(e=>e.completed)},getAll(){return[...i]},load(e){i=e.map(t=>new C(t))},toPlainObject(){return i.map(e=>e.toPlainObject())}};class b{constructor({id:t,name:o}){this.id=t??crypto.randomUUID(),this.name=o}toPlainObject(){return{...this}}}let u=[],y=null;const s={add(e){const t=new b(e);return u.push(t),t},edit(e,t){const o=this.getById(e);return o?(Object.assign(o,t),!0):!1},remove(e){const t=u.findIndex(o=>o.id===e);return t===-1?!1:(u.splice(t,1),y===e&&(y=u[0]?.id??null),!0)},getById(e){return u.find(t=>t.id===e)},getFirstIdByName(e){return u.find(t=>t.name===e).id},getAll(){return[...u]},getActive(){return this.getById(y)},getActiveId(){return y},setActive(e){this.getById(e)&&(y=e)},createDefaultProject(){const e=this.add({name:"My Project"});return this.setActive(e.id),e},load(e){u=e.map(t=>new b(t))},toPlainObject(){return u.map(e=>e.toPlainObject())}},T="todoAppData",A=1,w={save(e,t,o){const d={version:A,data:{projects:e,todos:t,viewState:o}};localStorage.setItem(T,JSON.stringify(d))},load(){try{const e=localStorage.getItem(T);if(!e)return null;const t=JSON.parse(e);if(t.version!==A)throw new Error("Version mismatch");return t.data}catch(e){return console.warn("Storage load failed:",e),null}},clear(){localStorage.removeItem(T)}};let v="project",I=null;const n={getCurrentView(){return v},setProjectView(e){v="project",I=e},setCompletedView(){v="completed"},isCompletedView(){},getActiveProjectId(){return I},toPlainObject(){return v==="project"?{type:"project",projectId:I}:v==="completed"?{type:"completed"}:null},load(e){v=e.type,I=e.projectId}},m={bindUIEvents(e){document.querySelector("#add-project")?.addEventListener("click",e.handleAddProject),document.querySelector("#add-todo")?.addEventListener("click",e.handleAddTodo),document.querySelector("#toggle-completed")?.addEventListener("click",e.handleToggleCompleted),document.querySelector("#project-list")?.addEventListener("click",t=>{const o=t.target.closest("li")?.dataset.id;o&&(t.target.matches("#project-edit-btn")?e.handleClickProjectEdit(o):e.handleSelectProject(o))}),document.querySelector("#todo-list")?.addEventListener("click",t=>{const o=t.target.closest("li")?.dataset.id;o&&(t.target.matches(".complete-btn")?(t.target.closest("li")?.classList.add("fading-out"),setTimeout(()=>{e.handleToggleTodo(o)},400)):t.target.matches(".todo-delete-btn")?e.handleRemoveTodo(o):e.handleSelectTodo(o))}),document.querySelector("#delete-all-completed-btn")?.addEventListener("click",e.handleRemoveCompleted),document.querySelector("#delete-project-btn")?.addEventListener("click",t=>{this.confirmDialog("⚠️ WARNING: When you delete a project, all its tasks will be deleted as well.")&&(e.handleDeleteProject(t.target.dataset.id),document.querySelector("#modal-overlay").classList.add("hidden"))}),document.querySelector("#toggle-sidebar")?.addEventListener("click",()=>{document.querySelector("aside")?.classList.toggle("open")})},renderProjects(e,t){const o=document.querySelector("#project-list");o.innerHTML="",e.forEach(d=>{const r=document.createElement("li"),l=document.createElement("button");r.textContent=d.name,r.dataset.id=d.id,d.id===t&&(r.style.fontWeight="bold",r.style.backgroundColor="rgba(171, 233, 163, 0.3)"),l.textContent="edit",l.id="project-edit-btn",r.appendChild(l),o.appendChild(r)})},renderTodos(e){const t=document.querySelector("#todo-list");t.innerHTML="",e.forEach(o=>{const d=document.createElement("li");d.dataset.id=o.id,d.classList.add(`priority-${o.priority}`),d.innerHTML=`
        <div class="left-part">  
          <button class="complete-btn">${o.completed?"Restore":"Done"}</button>
          <div class="todo-content">
            <div class="todo-title">${o.title}</div>
            <div class="todo-desc">${o.description}</div>
          </div>
        </div>
        <button class="todo-delete-btn">Delete</button>
      `,t.appendChild(d)})},toggleDeleteAllCompletedBtn(e){document.querySelector("#delete-all-completed-btn").classList.toggle("hidden",!e)},confirmDialog(e){return confirm(e)},openModal({title:e,projectForm:t=!1,editForm:o=!1,defaultTodoInfo:d,activeProjectId:r,allProjects:l,targetId:f,targetProject:E,onSubmit:L}){const h=document.querySelector("#modal"),a=h.querySelector("form"),q=h.querySelector("#modal-description-wrapper"),B=h.querySelector("fieldset");h.querySelector("#modal-form label").textContent=e,q.classList.toggle("hidden",t),B.classList.toggle("hidden",t);const S=h.querySelector("#delete-project-btn");if(S.classList.toggle("hidden",!o||!t),S.dataset.id="",S.dataset.id=f,h.querySelector("#move-to-project").classList.toggle("hidden",!o||t),a.reset(),document.querySelector("#modal-overlay").classList.remove("hidden"),h.querySelector("#modal-cancel")?.addEventListener("click",()=>{document.querySelector("#modal-overlay").classList.add("hidden")}),a.elements.title.focus(),!t&&o){a.elements.title.value=d.title,a.elements.description.value=d.description,a.elements.priority.value=d.priority;const P=h.querySelector("#move-to-project select");P.innerHTML="",l.forEach(g=>{const j=document.createElement("option");j.value=g.id,j.textContent=g.name,P.appendChild(j),g.id===r&&(j.selected=!0)})}t&&o&&(a.elements.title.value=E.name),a.onsubmit=P=>{P.preventDefault();const g=a.elements.title.value.trim(),j=g,O=a.elements.description?.value.trim()??"",D=a.elements.priority?.value??"low",M=a.elements.project?.value;g&&(document.querySelector("#modal-overlay").classList.add("hidden"),L?.({title:g,name:j,description:O,priority:D,newProjectId:M}))}}},p={init(){const e=w.load();if(e.projects[0])n.load(e.viewState),s.load(e.projects),s.setActive(n.getActiveProjectId()),c.load(e.todos);else{const t=s.createDefaultProject();n.setProjectView(t.id),this.persist()}m.bindUIEvents(this),this.renderProjects(),this.renderTodos()},renderProjects(){m.renderProjects(s.getAll(),s.getActiveId())},renderTodos(){const e=n.getCurrentView(),t=n.getActiveProjectId();if(!e)return;let o=c.getByProject(t);e==="completed"&&(o=c.getCompleted().filter(l=>l.projectId===t));const d=e==="completed";m.toggleDeleteAllCompletedBtn(d),m.renderTodos(o)},handleAddTodo(){n.getActiveProjectId()&&m.openModal({title:"New Task",projectForm:!1,onSubmit({title:e,description:t,priority:o}){c.add({title:e+" and love Ed",description:t,priority:o,projectId:n.getActiveProjectId()}),p.persist(),p.renderTodos()}})},handleEditTodo(e,t){c.edit(e,t),this.persist(),this.renderTodos()},handleEditProject(e,t){s.edit(e,t),this.persist(),this.renderProjects()},handleRemoveTodo(e){c.remove(e),this.persist(),this.renderTodos()},handleToggleTodo(e){const t=c.getById(e);t&&(t.completed?c.restore(e):c.markComplete(e),this.persist(),this.renderProjects(),this.renderTodos())},handleAddProject(){m.openModal({title:"New Project",projectForm:!0,onSubmit({title:e}){const t=s.add({name:e});p.handleSelectProject(t.id)}})},handleDeleteProject(e){s.remove(e),c.removeByProject(e),n.setProjectView(s.getActiveId()),this.persist(),this.renderProjects(),this.renderTodos()},handleMoveToProject(e,t){t&&(c.moveToProject(e,t),this.persist(),this.renderProjects(),this.renderTodos())},handleSelectProject(e){s.setActive(e),n.setProjectView(e),this.persist(),this.renderProjects(),this.renderTodos()},handleClickProjectEdit(e){e&&m.openModal({title:"Project Name:",projectForm:!0,editForm:!0,activeProjectId:n.getActiveProjectId(),targetId:e,targetProject:s.getById(e),onSubmit:({name:t})=>{this.handleEditProject(e,{name:t})}})},handleToggleCompleted(){n.getCurrentView()==="completed"?n.setProjectView(n.getActiveProjectId()):n.setCompletedView(),p.persist(),p.renderProjects(),p.renderTodos()},handleRemoveCompleted(){if(n.getCurrentView()==="completed"){const t=c.getCompleted().filter(o=>o.projectId===n.getActiveProjectId());if(!t[0]||!m.confirmDialog("⚠️ WARNING: Are you sure to delete all the completed tasks in this project?"))return;t.forEach(o=>c.remove(o.id)),p.persist(),p.renderTodos()}},handleSelectTodo(e){const t=c.getById(e);t&&m.openModal({title:"Title: ",projectForm:!1,editForm:!0,defaultTodoInfo:t,activeProjectId:n.getActiveProjectId(),allProjects:s.getAll(),onSubmit:({title:o,description:d,priority:r,newProjectId:l})=>{this.handleEditTodo(e,{title:o,description:d,priority:r}),this.handleMoveToProject(e,l)}})},persist(){w.save(s.toPlainObject(),c.toPlainObject(),n.toPlainObject())}};p.init();
